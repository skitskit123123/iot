#include <DHTesp.h>
#include <WiFi.h>
#include<ThingSpeak.h>
DHTesp dhtSensor;
TempAndHumidity data;
const int dhtpin=15;

char ssid[]="Wokwi-GUEST";
char pass[]="";
WiFiClient client;

unsigned long myChannelNumber=  2330696;
const char* myWriteAPIKey="58EV8IN088WTTXLP";
int statusCode;

void setup() {
  // put your setup code here, to run once:
  Serial.begin(115200);
  dhtSensor.setup(dhtpin,DHTesp::DHT22);
  WiFi.mode(WIFI_STA);
  ThingSpeak.begin(client);
  delay(1000);
}

void getwifi()
{
  if(WiFi.status()!=WL_CONNECTED)
  {
     Serial.print("Attempting to connect");
     while(WiFi.status()!=WL_CONNECTED)
    {
      WiFi.begin(ssid,pass);
      Serial.print(".");
      delay(5000);
    }
  }
  Serial.println("\nConnected");
}


void loop() {
  getwifi();
  data =dhtSensor.getTempAndHumidity();
  Serial.println("Humi:"+String(data.humidity));
  Serial.println("Temp:"+String(data.temperature));
  Serial.println("<-------------------->"); // this speeds up the simulation
  ThingSpeak.setField(1,data.humidity);
  ThingSpeak.setField(2,data.temperature);
   statusCode=ThingSpeak.writeFields(myChannelNumber,myWriteAPIKey);
   
  if(statusCode==200)
  {
    Serial.println("Channel update successful");
  }
  else
  {
    Serial.println("Problem Writing data: HTTp error code:"+String(statusCode));
  }
  delay(15000);
}
